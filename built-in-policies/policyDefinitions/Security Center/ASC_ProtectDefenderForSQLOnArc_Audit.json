{
  "properties": {
    "displayName": "[Deprecated]: Microsoft Defender for SQL status should be protected for Arc-enabled SQL Servers",
    "policyType": "BuiltIn",
    "mode": "Indexed",
    "description": "This policy is being deprecated because Microsoft Defender for Cloud now provides an updated recommendation that replaces the functionality previously delivered by this policy. The new recommendation offers improved accuracy and coverage for monitoring the protection status. You can use the updated recommendation here: https://aka.ms/NewStatusRecommendation. Learn more about policy definition deprecation at aka.ms/policydefdeprecation.",
    "metadata": {
      "version": "1.2.0-deprecated",
      "category": "Security Center",
      "deprecated": true
    },
    "version": "1.2.0",
    "parameters": {
      "effect": {
        "type": "string",
        "defaultValue": "Disabled",
        "allowedValues": [
          "Audit",
          "Disabled"
        ],
        "metadata": {
          "displayName": "Effect",
          "description": "Enable or disable the execution of the policy"
        }
      }
    },
    "policyRule": {
      "if": {
        "allOf": [
          {
            "field": "type",
            "equals": "Microsoft.AzureArcData/sqlServerInstances"
          },
          {
            "anyOf": [
              {
                "field": "Microsoft.AzureArcData/sqlServerInstances/azureDefenderStatus",
                "Equals": "Not Protected"
              },
              {
                "allOf": [
                  {
                    "field": "Microsoft.AzureArcData/sqlServerInstances/azureDefenderStatus",
                    "notEquals": "Not Protected"
                  },
                  {
                    "value": "[field('Microsoft.AzureArcData/sqlServerInstances/azureDefenderStatusLastUpdated')]",
                    "less": "[addDays(utcNow(), -1)]"
                  }
                ]
              }
            ]
          }
        ]
      },
      "then": {
        "effect": "[parameters('effect')]"
      }
    },
    "versions": [
      "1.2.0",
      "1.1.0",
      "1.0.1"
    ]
  },
  "id": "/providers/Microsoft.Authorization/policyDefinitions/938c4981-c2c9-4168-9cd6-972b8675f906",
  "name": "938c4981-c2c9-4168-9cd6-972b8675f906"
}